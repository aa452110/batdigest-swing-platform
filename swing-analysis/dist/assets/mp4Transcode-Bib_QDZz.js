import{_ as m}from"./index-T-bQ0YIv.js";let p=!1,d=null,a=null;function y(){return p}async function w(){if(p)return;const[{FFmpeg:o},n]=await Promise.all([m(()=>import("./index-CUxsIblL.js"),[]),m(()=>import("./index-607UPNXL.js"),[])]);d=o;let r,c;const e="https://swing-platform.brianduryea.workers.dev/api/ffmpeg-core/";r=e+"ffmpeg-core.js",c=e+"ffmpeg-core.wasm",a=new d;const t={coreURL:r,wasmURL:c};await a.load(t),p=!0}async function b(o,n){await w(),a.on("progress",({progress:s})=>{n&&n(Math.max(0,Math.min(100,Math.round(s*100))))});const{fetchFile:r}=await m(async()=>{const{fetchFile:s}=await import("./index-607UPNXL.js");return{fetchFile:s}},[]),c=await r(o),e="input.webm",t="output.mp4";await a.writeFile(e,c);const l=["-i",e,"-map","0:v:0","-map","0:a:0","-c:v","libx264","-pix_fmt","yuv420p","-preset","veryfast","-crf","23","-c:a","aac","-b:a","128k","-ac","2","-ar","48000","-movflags","+faststart","-shortest",t];await a.exec(l);const i=await a.readFile(t),f=new Blob([i],{type:"video/mp4"});try{await a.deleteFile(e)}catch{}try{await a.deleteFile(t)}catch{}return f}async function v(o,n){if(p)return;const r="https://swing-platform.brianduryea.workers.dev/api/ffmpeg-core/",c=[{url:r+"ffmpeg-core.js",label:"core.js"},{url:r+"ffmpeg-core.wasm",label:"core.wasm"}];let e=0,t=0;for(const l of c){o?.(`Loading FFmpeg (${l.label})…`);const i=await fetch(l.url,{cache:"force-cache"});if(!i.ok)throw new Error(`Failed to fetch ${l.label}: ${i.status}`);const f=i.headers.get("content-length"),s=f?parseInt(f,10):0;s&&(e+=s);const u=i.body?.getReader();if(!u){await i.arrayBuffer();continue}for(;;){const{done:g,value:h}=await u.read();if(g)break;if(t+=h?.length||0,n&&e){const _=Math.max(0,Math.min(100,Math.round(t/e*100)));n(_)}}}o?.("Initializing FFmpeg…"),await w(),o?.("Ready")}export{y as isFfmpegLoaded,v as preloadFfmpeg,b as transcodeWebmToMp4};
